{% extends 'base.html' %}
{% block title %}{% if form.instance.pk %}Edit Task{% else %}New Task{% endif %} Â· TODO{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto">
  <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold text-slate-900">
        {% if form.instance.pk %}
          <i class="fas fa-edit mr-2"></i>Edit Task
        {% else %}
          <i class="fas fa-plus mr-2"></i>New Task
        {% endif %}
      </h1>
      <a href="{% url 'dashboard' %}" class="text-slate-600 hover:text-slate-900 px-3 py-2 rounded-lg hover:bg-slate-100 transition-colors">
        <i class="fas fa-times"></i>
      </a>
    </div>

    <form method="post" class="space-y-6">
      {% csrf_token %}
      
      <!-- Title -->
      <div>
        <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
          <i class="fas fa-heading mr-2"></i>Title *
        </label>
        {{ form.title }}
        {% if form.title.errors %}
          <div class="mt-1 text-sm text-red-600">{{ form.title.errors.0 }}</div>
        {% endif %}
      </div>

      <!-- Description -->
      <div>
        <label for="{{ form.description_md.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
          <i class="fas fa-align-left mr-2"></i>Description
        </label>
        {{ form.description_md }}
        {% if form.description_md.errors %}
          <div class="mt-1 text-sm text-red-600">{{ form.description_md.errors.0 }}</div>
        {% endif %}
        <p class="mt-1 text-xs text-slate-500">Supports Markdown formatting</p>
      </div>

      <!-- Grid Layout for Form Fields -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Status -->
        <div>
          <label for="{{ form.status.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-tasks mr-2"></i>Status
          </label>
          {{ form.status }}
          {% if form.status.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.status.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Priority -->
        <div>
          <label for="{{ form.priority.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-flag mr-2"></i>Priority
          </label>
          {{ form.priority }}
          {% if form.priority.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.priority.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Project -->
        <div>
          <label for="{{ form.project.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-folder mr-2"></i>Project
          </label>
          {{ form.project }}
          {% if form.project.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.project.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Parent Task -->
        <div>
          <label for="{{ form.parent.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-sitemap mr-2"></i>Parent Task
          </label>
          {{ form.parent }}
          {% if form.parent.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.parent.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Start Date -->
        <div>
          <label for="{{ form.start_at.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-calendar-plus mr-2"></i>Start Date
          </label>
          {{ form.start_at }}
          {% if form.start_at.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.start_at.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Due Date -->
        <div>
          <label for="{{ form.due_at.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-calendar-check mr-2"></i>Due Date
          </label>
          {{ form.due_at }}
          {% if form.due_at.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.due_at.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Estimate -->
        <div>
          <label for="{{ form.estimate_minutes.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-clock mr-2"></i>Estimate (minutes)
          </label>
          {{ form.estimate_minutes }}
          {% if form.estimate_minutes.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.estimate_minutes.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Repeat -->
        <div>
          <label for="{{ form.repeat.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
            <i class="fas fa-redo mr-2"></i>Repeat
          </label>
          {{ form.repeat }}
          {% if form.repeat.errors %}
            <div class="mt-1 text-sm text-red-600">{{ form.repeat.errors.0 }}</div>
          {% endif %}
        </div>
      </div>

      <!-- External URL -->
      <div>
        <label for="{{ form.external_url.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
          <i class="fas fa-external-link-alt mr-2"></i>External URL
        </label>
        {{ form.external_url }}
        {% if form.external_url.errors %}
          <div class="mt-1 text-sm text-red-600">{{ form.external_url.errors.0 }}</div>
        {% endif %}
      </div>

      <!-- Tags -->
      <div>
        <label for="{{ form.tags.id_for_label }}" class="block text-sm font-medium text-slate-700 mb-2">
          <i class="fas fa-tags mr-2"></i>Tags
        </label>
        {{ form.tags }}
        {% if form.tags.errors %}
          <div class="mt-1 text-sm text-red-600">{{ form.tags.errors.0 }}</div>
        {% endif %}
        <p class="mt-1 text-xs text-slate-500">Hold Ctrl/Cmd to select multiple tags</p>
      </div>

      <!-- Form Actions -->
      <div class="flex items-center justify-between pt-6 border-t border-slate-200">
        <div class="flex items-center gap-3">
          <button type="submit" class="bg-sky-600 hover:bg-sky-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center gap-2">
            <i class="fas fa-save"></i>
            {% if form.instance.pk %}Update Task{% else %}Create Task{% endif %}
          </button>
          <a href="{% url 'dashboard' %}" class="px-6 py-3 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors">
            Cancel
          </a>
        </div>
        
        {% if form.instance.pk %}
          <a href="{% url 'task_detail' form.instance.pk %}" class="text-slate-600 hover:text-slate-900 flex items-center gap-2">
            <i class="fas fa-eye"></i> View Task
          </a>
        {% endif %}
      </div>
    </form>
  </div>
</div>

<style>
/* Form field styling */
form input[type="text"],
form input[type="url"],
form input[type="number"],
form input[type="datetime-local"],
form select,
form textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  transition: all 0.2s ease;
}

form input[type="text"]:focus,
form input[type="url"]:focus,
form input[type="number"]:focus,
form input[type="datetime-local"]:focus,
form select:focus,
form textarea:focus {
  outline: none;
  border-color: #0ea5e9;
  box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
}

form textarea {
  min-height: 120px;
  resize: vertical;
}

/* Select styling */
form select {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.5rem center;
  background-repeat: no-repeat;
  background-size: 1.5em 1.5em;
  padding-right: 2.5rem;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

/* Multiple select styling */
form select[multiple] {
  background-image: none;
  padding-right: 0.75rem;
  min-height: 120px;
}

/* Priority colors */
.priority-1 { color: #dc2626; }
.priority-2 { color: #ea580c; }
.priority-3 { color: #ca8a04; }
.priority-4 { color: #0284c7; }
.priority-5 { color: #64748b; }
</style>

<script>
// Auto-focus on title field
document.addEventListener('DOMContentLoaded', function() {
  const titleField = document.getElementById('{{ form.title.id_for_label }}');
  if (titleField) {
    titleField.focus();
  }
});

// Quick shortcuts for common values
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case '1':
        e.preventDefault();
        document.getElementById('{{ form.priority.id_for_label }}').value = '1';
        break;
      case '2':
        e.preventDefault();
        document.getElementById('{{ form.priority.id_for_label }}').value = '2';
        break;
      case '3':
        e.preventDefault();
        document.getElementById('{{ form.priority.id_for_label }}').value = '3';
        break;
      case '4':
        e.preventDefault();
        document.getElementById('{{ form.priority.id_for_label }}').value = '4';
        break;
      case '5':
        e.preventDefault();
        document.getElementById('{{ form.priority.id_for_label }}').value = '5';
        break;
    }
  }
});
</script>
{% endblock %} 